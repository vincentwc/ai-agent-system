## 第 2 周：Python 进阶 & LangChain 入门

**目标**：掌握 Python 高级语法与 LangChain 核心组件，实现一个基于 LangChain 的天气助手智能体，并完成 Dify 与手写 LangChain 的对比分析。

## 🎯 本周核心目标

- ✅ 掌握 Python 类、函数、列表推导、`requests` 库使用  
- ✅ 学会使用 Pydantic 定义工具输入校验模型  
- ✅ 理解 LangChain 核心概念（LLM、PromptTemplate、Tool、AgentExecutor）  
- ✅ 实现 `weather_agent_langchain.py`：基于 LangChain 的天气查询智能体  
- ✅ 输出对比笔记：Dify vs LangChain（控制流、调试难度、扩展性）

---

```

---

## 🧠 技术学习重点

### 1. Python 进阶技能

| 技能点 | 说明 |
|--------|------|
| **类与对象** | 使用 `class` 封装逻辑，如定义 `WeatherService` 类 |
| **函数定义** | 支持参数默认值、返回字典或字符串结果 |
| **列表推导式** | 替代 for 循环，简洁处理数据过滤与转换：<br>`[x for x in data if x > 0]` |
| **requests 库** | 发起 HTTP 请求获取外部 API 数据：<br>`response = requests.get(url)` |

### 2. Pydantic 数据模型（用于工具输入校验）

```python
from pydantic import BaseModel, Field

class WeatherInput(BaseModel):
    city: str = Field(..., description="城市名称")
    unit: str = Field("celsius", description="温度单位")
```

> ✅ 优势：自动校验输入合法性，防止无效参数传入

### 3. LangChain 核心组件

| 组件 | 作用 |
|------|------|
| **LLM** | 调用大模型服务（如 Qwen、OpenAI），生成文本响应 |
| **PromptTemplate** | 动态构建提示词模板 |
| **@tool 装饰器** | 将普通函数注册为 Agent 可调用的工具 |
| **AgentExecutor** | 驱动 Agent 自主决策并执行动作链 |

---

## 💼 实践任务与交付物

### ✅ 交付物 1：`weather_agent_langchain.py`

#### 功能要求
- 用户提问：“北京今天的天气怎么样？”
- 智能体识别需调用“天气查询”工具
- 工具通过 `@tool` 注册，接收带校验的输入参数
- 使用 `PromptTemplate` 构造自然语言输出
- 最终由 `AgentExecutor` 控制流程并返回回答

#### 示例代码结构（简化版）

```python
from langchain_community.llms import Tongyi  # 或 OpenAI
from langchain_core.prompts import PromptTemplate
from langchain.agents import AgentExecutor, create_react_agent
from langchain.tools import tool
from pydantic import BaseModel, Field

# Step 1: 定义输入模型
class WeatherInput(BaseModel):
    city: str = Field(..., description="城市名称")

# Step 2: 使用 @tool 装饰器定义工具
@tool(args_schema=WeatherInput)
def get_weather(city: str) -> str:
    """模拟获取天气信息"""
    return f"{city}今天晴转多云，气温20-25°C"

# Step 3: 初始化 LLM 和 Prompt
llm = Tongyi(model="qwen-max", api_key="your-api-key")
template = """你是一个助手，请根据以下工具返回的信息回答问题：
{tools}
{tool_names}
{agent_scratchpad}
"""
prompt = PromptTemplate.from_template(template)

# Step 4: 创建 agent 并运行
agent = create_react_agent(llm, tools=[get_weather], prompt=prompt)
agent_executor = AgentExecutor(agent=agent, tools=[get_weather])

# 测试调用
result = agent_executor.invoke({"input": "北京今天的天气如何？"})
print(result["output"])
```

> 📁 文件路径建议：`python-agent/core/weather_agent_langchain.py`

---

### ✅ 交付物 2：对比笔记 —— Dify vs LangChain

| 对比维度 | Dify | LangChain（手写） |
|---------|------|------------------|
| **控制粒度** | 中等，依赖可视化节点配置 | 高，可精细控制每一步逻辑 |
| **调试难度** | 较高，日志分散，难以断点追踪 | 低，支持本地调试、打印中间步骤 |
| **扩展性** | 插件有限，自定义能力受限 | 极强，支持自定义工具链、记忆机制、路由策略 |
| **开发效率** | 快速搭建原型，适合非程序员 | 初始成本高，但长期维护更灵活 |
| **适用场景** | MVP 验证、简单问答机器人 | 复杂业务系统、企业级 AI Agent 集成 |

> 📝 结论建议：
> - 初期可用 Dify 快速验证产品想法；
> - 中后期推荐使用 LangChain 构建可维护、可扩展的生产级系统。

> 📁 建议文件路径：`docs/comparison_dify_vs_langchain.md`

---

## 🛠️ 增强建议（加分项）

- ✅ 使用虚拟环境管理依赖（`venv` + `requirements.txt`）
- ✅ 添加日志记录 agent 决策过程（便于调试）
- ✅ 尝试切换不同 LLM（如通义千问 / DeepSeek / GPT-3.5）
- ✅ 模拟错误输入，测试 Pydantic 校验是否生效

---

## 📦 环境准备检查清单

| 项目 | 是否完成 |
|------|----------|
| 安装 Python 3.10+ | □ |
| 创建虚拟环境：`python -m venv venv` | □ |
| 激活环境并安装依赖：<br>`pip install langchain langchain-community requests pydantic dashscope` | □ |
| 获取大模型 API Key（如阿里云百炼平台） | □ |
| 成功调用一次 LLM API（如输出“你好”） | □ |

---

## 🗂️ 项目目录更新建议

```bash
ai-agent-system/
├── python-agent/
│   └── core/
│       └── weather_agent_langchain.py     ← 新增
├── docs/
│   └── comparison_dify_vs_langchain.md   ← 新增
├── requirements.txt                      ← 推荐添加
└── .gitignore
```

---

## 🔜 下周预热：第 3 周 RAG 基础

提前准备：
- [ ] 下载一份真实文档（PDF/TXT/Markdown），如公司制度或技术手册
- [ ] 安装文档加载库：<br>`pip install PyPDF2 unstructured langchain-experimental`
- [ ] 了解文本切片策略（固定长度 vs 语义分块）
- [ ] 注册 HuggingFace 账号，准备使用 `BAAI/bge-small-zh` embedding 模型

---

## 📎 资源推荐

- [LangChain 官方文档](https://python.langchain.com/)
- [LangChain 中文社区](https://www.langchain.com.cn/)
- [Qwen 大模型接入指南（阿里云）](https://help.aliyun.com/zh/qwen)
- [Pydantic 官方文档](https://docs.pydantic.dev/)

---

📌 **Java 程序员特别提示**：

> “不必精通 Python 语法，重点是理解程序逻辑。”  
> 你已具备强大的工程思维 —— 模块化设计、异常处理、接口抽象。这些能力在构建 AI Agent 系统时至关重要。

> 后续可通过 Spring Boot 调用此 Python 服务（FastAPI 接口），充分发挥 Java 在企业系统的整合优势。

---

✅ **本周完成 checklist**

| 任务 | 完成情况 |
|------|----------|
| 掌握 Python 类、函数、列表推导、requests 使用 | □ |
| 使用 Pydantic 定义输入校验模型 | □ |
| 理解并应用 `@tool`、`PromptTemplate`、`AgentExecutor` | □ |
| 编写并运行 `weather_agent_langchain.py` | □ |
| 输出 Dify vs LangChain 对比笔记 | □ |
| 提交代码至 GitHub 仓库 | □ |

---

🎉 恭喜完成第二周任务！  
👉 下一步进入 **第3周：RAG 基础（检索增强生成）**
```

---

✅ **使用说明**：
1. 将上述内容保存为 `week2-python-advanced-langchain.md`
2. 放入你的项目根目录或 `docs/` 文件夹
3. 每完成一项打勾 ✔️，保持进度可视

需要我帮你生成：
- `requirements.txt` 示例？
- Notion 模板链接？
- 第三周的 MD 文档？

欢迎继续告诉我！祝你学习顺利 🚀